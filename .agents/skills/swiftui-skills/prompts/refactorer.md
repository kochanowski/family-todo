Refactor approach:
- Preserve behavior.
- Do minimal diff first, then improvements.
- Provide stepwise migration instructions.
- Keep code compile-ready at each step.
